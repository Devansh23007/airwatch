<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AirWatch</title>
  <link rel="stylesheet" href="/static/style.css">
</head>

<body class="index-page">

<header class="main-header center">
  <h1>
    <span class="grad">Air Quality</span><br>
    Intelligence
  </h1>
  <p>Smart Campus â€“ Live Air Monitoring</p>
</header>

<section class="building-select">

  <!-- ANVIKSHA -->
  <div class="building-card card-anviksha" onclick="go('Anviksha')">
    <h2>Anviksha</h2>
    <div class="aqi-preview" id="aqi-Anviksha">AQI: --</div>

    <div class="hover-info">
      <div>ðŸŒ¡ <span id="temp-Anviksha">--</span>Â°C</div>
      <div>ðŸ’§ <span id="hum-Anviksha">--</span>%</div>
    </div>
  </div>

  <!-- SOT -->
  <div class="building-card card-sot" onclick="go('SOT')">
    <h2>SOT</h2>
    <div class="aqi-preview" id="aqi-SOT">AQI: --</div>

    <div class="hover-info">
      <div>ðŸŒ¡ <span id="temp-SOT">--</span>Â°C</div>
      <div>ðŸ’§ <span id="hum-SOT">--</span>%</div>
    </div>
  </div>

  <!-- SOS -->
  <div class="building-card card-sos" onclick="go('SOS')">
    <h2>SOS</h2>
    <div class="aqi-preview" id="aqi-SOS">AQI: --</div>

    <div class="hover-info">
      <div>ðŸŒ¡ <span id="temp-SOS">--</span>Â°C</div>
      <div>ðŸ’§ <span id="hum-SOS">--</span>%</div>
    </div>
  </div>

</section>

<script>
function go(name) {
  window.location.href = `/building/${name}`;
}

function getColor(aqi) {
  if (aqi <= 50) return "green";
  if (aqi <= 100) return "yellow";
  if (aqi <= 200) return "orange";
  return "red";
}

function updateAQI(name) {
  fetch(`/api/building/${name}`)
    .then(res => res.json())
    .then(data => {

      /* AQI */
      const aqiEl = document.getElementById(`aqi-${name}`);
      if (aqiEl && typeof data.AQI === "number") {
        aqiEl.innerText = `AQI: ${data.AQI}`;

        const card = aqiEl.parentElement;
        card.classList.remove("green","yellow","orange","red");
        card.classList.add(getColor(data.AQI));
      }

      /* Hover info (SAFE: only update if exists) */
      const tempHover = document.getElementById(`temp-${name}`);
      const humHover  = document.getElementById(`hum-${name}`);

      if (tempHover) {
        tempHover.innerText =
          data.Temperature !== undefined ? data.Temperature : "--";
      }

      if (humHover) {
        humHover.innerText =
          data.Humidity !== undefined ? data.Humidity : "--";
      }
    })
    .catch(err => console.error("Index update error:", err));
}

/* Initial load */
["Anviksha","SOT","SOS"].forEach(updateAQI);

/* Refresh every 3 seconds */
setInterval(() => {
  ["Anviksha","SOT","SOS"].forEach(updateAQI);
}, 3000);
</script>

</body>
</html>
